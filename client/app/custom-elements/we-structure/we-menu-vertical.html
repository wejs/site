<link rel="import" href="../../../bower_components/polymer/polymer.html">

<script type="text/javascript" src="../../../bower_components/metisMenu/dist/metisMenu.min.js"></script>

<dom-module id="we-menu-vertical">
  <style>
    :host {
      display: block;
    }
  </style>
  <template></template>
</dom-module>
<script>
  Polymer({
    is: 'we-menu-vertical',
    properties: {
      menu: String,
      links: {
        type: Array
      },
      basepath: String,
      title: String
    },

    ready: function() {
      var self = this;

      var App = window.App;
      if (!this.menu) return console.error('menu attribute is required for we-menu');

      window.$.get('http://wejs.dev/public/project/client/admin/styles/menu.json')
      .then(function(menu){

        self.links = menu.links;
        self.basepath = menu.basepath;
        self.title = menu.title;

        var html = '';
        for (var i = 0; i < menu.links.length; i++) {
          html += self.buildLink(menu.links[i]);
        };

        self.innerHTML = html;

        window.$(self).metisMenu();
      });
    },
    buildLink: function(link) {
      var html = '<li>';
      html += '<a ';

      if (link.url) html += ' href="'+this.basepath+ link.url+'" ';
      if (link.class) html += 'class="'+link.class + '" ';

      html+= '>';

      if (link.icon) html += link.icon + ' ';
      if (link.text) html += link.text;

      if (link.links) {
        html += '<span class="fa arrow"></span></a>';

        html += this.buildSubMenu(link.links);
      } else {
        html += '</a>';
      }

      html += '</li>';

      return html;
    },

    buildSubMenu: function(links) {
      var html = '<ul class="nav nav-second-level collapse">';
      for (var i = 0; i < links.length; i++) {
        html += this.buildLink(links[i]);
      };
      html += '</ul>';
      return html;
    },
  });
</script>